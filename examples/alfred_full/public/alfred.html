<!DOCTYPE html>
<html>
<head>
    <title>Alfred: Batman's Todos</title>
    
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="resources/alfred.css" type="text/css">
    
    <script type="text/javascript" src="../lib/batman.js"></script>
</head>

<body>
    <div id="container">
        <h1>Alfred</h1>
        
        <input class="new-item" placeholder="add a todo item" data-events="submit: Alfred.TodosController.add" />
        
        <ul id="items">
            <li data-each-todo="Alfred.Todo.all" data-mixin="animation">
                <input type="checkbox" data-bind="todo.isDone" />
                <label data-bind="todo.body" data-classes="done: todo.isDone" data-mixin="editor"></label>
                <a data-route="todo.destroy">delete</a>
            </li>
        </ul>
    </div>
    
    <script>
    Batman.ready(function() {
        
        Alfred = Batman.App();
        
        Alfred.Todo = Batman.Model('todos', {
            body: $binding().validate(function(value) {
                return value || 'emtpy todo...';
            }),
            
            isDone: $binding(false),
            
            serialize: function() {
                return {
                    todo: {
                        body: this.body(),
                        is_done: this.isDone()
                    }
                };
            },
            
            unserialize: function(data) {
                this.body(data.body);
                this.isDone(data.is_done);
            }
        }, Batman.RestStorage('http://localhost:3000'));
        
        Alfred.TodosController = Batman.Controller({
            add: function(text, node) {
                Alfred.Todo({body: text}).save();
                
                node.value = '';
                node.blur();
            }
        });
        
        Alfred.Settings = Batman.Model.Singleton({
            fontSize: $binding(20).observeForever(function(size) {
                var labels = document.getElementsByTagName('label'),
                    i = labels.length;
                
                while (i--)
                    labels[i].style.fontSize = size + 'pt';
            })
        });
        
        Alfred.Todo.load(function() {
            if (!Alfred.Todo.all().length) {
                Alfred.Todo({body: 'riddler sent riemann hypothesis'}).save();
                Alfred.Todo({body: 'bane wants to meet, not worried'}).save();
                Alfred.Todo({body: 'joker escaped arkham again'}).save();
            }
        });
        
        Alfred.run();
        
    });
    </script>
</body>
</html>
