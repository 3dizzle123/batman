<!DOCTYPE html>
<html lang="en">
<head>
  <title>Crime Fighting</title>
  
  <link rel="stylesheet" href="resources/reset.css">
  <link rel="stylesheet" href="resources/style.css">
  
  <script type="text/javascript" src="http://use.typekit.com/kek3ffx.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  
  <script src="lib/coffee-script.js"></script>
  <script src="lib/batman.js"></script>
  <script src="nowjs/now.js"></script>
  
  <script src="resources/raphael-min.js"></script>
  <script src="resources/progress.js"></script>
</head>

<body id="home">
  <div id="header-wrapper">
    <div id="header">
      <h1 id="logo">
        <a href="#">batman.js</a>
      </h1>
      
      <div style="clear:both;"></div>
      
      <div id="intro-wrapper">
        <div id="intro-statement">
          <h2 data-bind="App.status">Crime Status</h2>
          <h1 style="color: #fff; font-size: 52px" data-bind="App.status2">No Crime!</h1>
          <h1 style="color: #fff; font-size: 78px; margin-top: 10px" data-visible="App.showNumber">1-888-9-BATMAN</h1>
          <h2 style="color: #fff; font-size: 42px; margin-top: 10px" data-visible="App.showNumber">to report crime!</h1>
        </div>
        
        <div id="download-box" style="margin-top:-20px">
          <img src="resources/batman.png" style="background-color:rgba(255,255,255,0.1); -webkit-border-radius: 10px; width: 201px; padding: 15px" /><br /><br />
          <div id="canvas"></div>
        </div>
      </div>
    </div>
  </div>
  
  <ul id="callers" style="position:absolute; left: 75px; top: 450px">
  </ul>
  
  <script type="text/coffeescript">
  progress = new ProgressBar(216, 500)
  
  class Gotham extends Batman.App
    status: 'Crime Status'
    status2: 'No Crime!'
    percentage: 0
    
    showNumber: @property ->
      @get('percentage') > 0
  
  Gotham.run()
  
  App.observe 'percentage', (p) ->
    progress.update(p)
    
    if p >= 100
      now.turnOnBatsignal()
  
  now.startCrime = ->
    App.set 'status', 'Crime detected!'
    App.set 'status2', 'Please call'
    App.set 'percentage', 10
    App.set 'showNumber', yes
  
  now.updatePercentage = (p) ->
    App.set 'percentage', p
  
  now.receiveCall = (number) ->
    li = document.createElement 'li'
    style = li.style
    style.display = 'block'
    style.width = '500px'
    style.height = '20px'
    style.padding = '20px'
    style.margin = '10px'
    style.backgroundColor = '#aaa'
    style.border = '#555 1px solid'
    style.color = '#fff'
    style.fontSize = '1.5em'
    style.webkitBorderRadius = '10px'
    li.innerHTML = '<p><strong>' + number + '</strong> reported some crime!</p>'
    console.log(li.innerHTML);
    
    callers = document.getElementById('callers')
    callers.insertBefore(li, callers.firstChild)
    
    App.set 'percentage', App.percentage + 5
  </script>
</body>
</html>
