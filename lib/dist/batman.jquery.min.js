(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=Array.prototype.slice,y=Object.prototype.hasOwnProperty,z=function(a,b){function d(){this.constructor=a}for(var c in b)y.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},A=function(a,b){return function(){return a.apply(b,arguments)}};j=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(j.Object,a,function(){})},j.typeOf=h=function(a){return w.call(a).slice(8,-1)},w=Object.prototype.toString,j.mixin=e=function(){var a,b,c,d,e,f,g,i,j;f=arguments[0],d=2<=arguments.length?x.call(arguments,1):[],e=f.set,a=typeof e=="function";for(i=0,j=d.length;i<j;i++){c=d[i];if(h(c)!=="Object")continue;for(b in c){g=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.call(f,b,g):f[b]=g}}return f},j.unmixin=i=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?x.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;a[b]=null,delete a[b]}typeof c.deinitialize=="function"&&c.deinitialize.call(a)}return a},j._block=a=function(a){var b;return b=function(){var b,c,d;b=1<=arguments.length?x.call(arguments,0):[],c=this,d=function(d){b.push(d);return a.apply(c,b)};return typeof b[b.length-1]=="function"?d(b.pop()):d}},j._findName=d=function(a,b){var c,d;if(!a.displayName)for(c in b){d=b[c];if(d===a){a.displayName=c;break}}return a.displayName},j.Property=function(){function a(a){a&&e(this,a)}a.prototype.isProperty=!0,a.prototype.resolve=function(){},a.prototype.assign=function(a){},a.prototype.remove=function(){},a.prototype.resolveOnObject=function(a){return this.resolve.call(a)},a.prototype.assignOnObject=function(a,b){return this.assign.call(a,b)},a.prototype.removeOnObject=function(a){return this.remove.call(a)};return a}(),j.AutonomousProperty=function(){function a(){a.__super__.constructor.apply(this,arguments)}z(a,j.Property),a.prototype.resolveOnObject=function(){return this.resolve()},a.prototype.assignOnObject=function(a,b){return this.assign(b)},a.prototype.removeOnObject=function(){return this.remove()};return a}(),j.Keypath=function(){function a(a,b){this.base=a,this.segments=b,h(this.segments)==="String"&&(this.segments=this.segments.split("."))}z(a,j.AutonomousProperty),a.prototype.path=function(){return this.segments.join(".")},a.prototype.depth=function(){return this.segments.length},a.prototype.slice=function(a,b){var c,d,e,f,g;c=this.base,g=this.segments.slice(0,a);for(e=0,f=g.length;e<f;e++){d=g[e];if(c==null||!(c=j.Observable.get.call(c,d)))return}return new j.Keypath(c,this.segments.slice(a,b))},a.prototype.finalPair=function(){return this.slice(-1)},a.prototype.eachPair=function(a){var b,c,d,e,f,g,h;b=this.base,g=this.segments,h=[];for(c=0,f=g.length;c<f;c++){e=g[c];if(!(d=j.Observable.get.call(b,e)))return;a(new j.Keypath(b,e),c),h.push(b=d)}return h},a.prototype.resolve=function(){var a;switch(this.depth()){case 0:return this.base;case 1:return j.Observable.get.call(this.base,this.segments[0]);default:return(a=this.finalPair())!=null?a.resolve():void 0}},a.prototype.assign=function(a){var b;switch(this.depth()){case 0:break;case 1:return j.Observable.set.call(this.base,this.segments[0],a);default:return(b=this.finalPair())!=null?b.assign(a):void 0}},a.prototype.remove=function(){switch(this.depth()){case 0:break;case 1:return j.Observable.unset.call(this.base,this.segments[0]);default:return this.finalPair().remove()}},a.prototype.isEqual=function(a){return this.base===a.base&&this.path()===a.path()};return a}(),j.Trigger=function(){function a(a,b,c,d){var e,f,g,h,i,k,l;this.base=a,this.key=b,this.targetKeypath=c,this.callback=d,l=[this.base,this.targetKeypath.base];for(g=0,h=l.length;g<h;g++){a=l[g];if(!a.observe)return;j.Observable.initialize.call(a)}((e=this.base._batman.outboundTriggers)[i=this.key]||(e[i]=new j.TriggerSet)).add(this),((f=this.targetKeypath.base._batman.inboundTriggers)[k=this.targetKeypath.path()]||(f[k]=new j.TriggerSet)).add(this)}a.populateKeypath=function(a,b){return a.eachPair(function(c,d){if(!!c.base.observe){j.Observable.initialize.call(c.base);return new j.Trigger(c.base,c.segments[0],a,b)}})},a.prototype.isEqual=function(a){return a instanceof j.Trigger&&this.base===a.base&&this.key===a.key&&this.targetKeypath.isEqual(a.targetKeypath)&&this.callback===a.callback},a.prototype.isInKeypath=function(){var a,b,c,d,e;b=this.targetKeypath.base,e=this.targetKeypath.segments;for(c=0,d=e.length;c<d;c++){a=e[c];if(b===this.base&&a===this.key)return!0;b=b!=null?b[a]:void 0;if(!b)return!1}},a.prototype.hasActiveObserver=function(){return this.targetKeypath.base.observesKeyWithObserver(this.targetKeypath.path(),this.callback)},a.prototype.remove=function(){var a,b,c,d;(b=(c=this.base._batman)!=null?c.outboundTriggers[this.key]:void 0)&&b.remove(this);if(a=(d=this.targetKeypath.base._batman)!=null?d.inboundTriggers[this.targetKeypath.path()]:void 0)return a.remove(this)};return a}(),j.Observable={initialize:function(){var a,b,c,d;j._initializeObject(this),(a=this._batman).observers||(a.observers={}),(b=this._batman).outboundTriggers||(b.outboundTriggers={}),(c=this._batman).inboundTriggers||(c.inboundTriggers={});return(d=this._batman).preventCounts||(d.preventCounts={})},rememberingOutboundTriggerValues:function(a,b){var c;j.Observable.initialize.call(this),(c=this._batman.outboundTriggers[a])&&c.rememberOldValues();return b.call(this)},keypath:function(a){return new j.Keypath(this,a)},_resolveObjectIfPossible:function(a){return(a!=null?a.isProperty:void 0)?a.resolveOnObject(this):a},get:function(a){var b;b=j.Observable.getWithoutResolution.apply(this,arguments);return j.Observable._resolveObjectIfPossible.call(this,b)},getWithoutResolution:function(a){return h(a)!=="String"||a.indexOf(".")===-1?j.Observable.getWithoutKeypaths.apply(this,arguments):new j.Keypath(this,a)},getWithoutKeypaths:function(a){return typeof this._get=="function"?this._get(a):this[a]},set:function(a,b){return h(a)!=="String"||a.indexOf(".")===-1?j.Observable.setWithoutKeypaths.apply(this,arguments):(new j.Keypath(this,a)).assign(b)},setWithoutKeypaths:function(a,b){var c,d;d=j.Observable.getWithoutResolution.call(this,a),c=j.Observable._resolveObjectIfPossible(d),j.Observable.rememberingOutboundTriggerValues.call(this,a,function(){(d!=null?d.isProperty:void 0)?d.assignOnObject(this,b):typeof this._set=="function"?this._set(a,b):this[a]=b;return typeof this.fire=="function"?this.fire(a,b,c):void 0});return b},unset:function(a){return h(a)!=="String"||a.indexOf(".")===-1?j.Observable.unsetWithoutKeypaths.apply(this,arguments):(new j.Keypath(this,a)).remove()},unsetWithoutKeypaths:function(a){var b,c;c=j.Observable.getWithoutResolution.call(this,a),b=j.Observable._resolveObjectIfPossible(c),j.Observable.rememberingOutboundTriggerValues.call(this,a,function(){(c!=null?c.isProperty:void 0)?c.removeOnObject(this):typeof this._unset=="function"?this._unset(a):(this[a]=null,delete this[a]);return typeof this.fire=="function"?this.fire(a,void 0,b):void 0})},observe:function(){var a,b,c,d,e,f,g,h;d=arguments[0],c=3<=arguments.length?x.call(arguments,1,h=arguments.length-1):(h=1,[]),a=arguments[h++],j.Observable.initialize.call(this),c=c[0]===!0,e=this.keypath(d),b=e.resolve(),f=(g=this._batman.observers)[d]||(g[d]=[]),f.push(a),e.depth()>1&&j.Trigger.populateKeypath(e,a),c&&a.call(this,b,b);return this},fire:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;if(!!this.allowed(a)){d=[b],typeof c!="undefined"&&d.push(c),n=[this._batman.observers[a],(l=this.constructor.prototype._batman)!=null?(m=l.observers)!=null?m[a]:void 0:void 0];for(h=0,j=n.length;h<j;h++){f=n[h];if(!f)continue;for(i=0,k=f.length;i<k;i++)e=f[i],e.apply(this,d)}if(g=this._batman.outboundTriggers[a])g.fireAll(),g.refreshKeypathsWithTriggers();(o=this._batman.inboundTriggers[a])!=null&&o.removeTriggersNotInKeypath();return this}},observesKeyWithObserver:function(a,b){var c,d,e,f,g,h;if(!((f=this._batman)!=null?(g=f.observers)!=null?g[a]:void 0:void 0))return!1;h=this._batman.observers[a];for(d=0,e=h.length;d<e;d++){c=h[d];if(c===b)return!0}return!1},forget:function(a,b){var c,d,e,f,g,h,i,k;j.Observable.initialize.call(this);if(a)if(b){if(e=this._batman.observers[a])c=e.indexOf(b),c!==-1&&e.splice(c,1);(g=this._batman.inboundTriggers[a])&&g.removeTriggersWithInactiveObservers()}else{k=this._batman.observers[a];for(h=0,i=k.length;h<i;h++)f=k[h],this.forget(a,f)}else for(d in this._batman.observers)this.forget(d);return this},prevent:function(a){var b;j.Observable.initialize.call(this),b=this._batman.preventCounts,b[a]||(b[a]=0),b[a]++;return this},allow:function(a){var b;j.Observable.initialize.call(this),b=this._batman.preventCounts,b[a]>0&&b[a]--;return this},allowed:function(a){var b;j.Observable.initialize.call(this);return!(((b=this._batman.preventCounts)!=null?b[a]:void 0)>0)}},j.EventEmitter={event:a(function(a,b,c){var f;!c&&typeof b!="undefined"&&(c=b),!c&&h(a)!=="String"&&(c=a,a=null),f=function(b){var e,g,h,i,k,l,m;if(!this.observe)throw"EventEmitter object needs to be observable.";j.Observable.initialize.call(this),a||(a=d(f,this)),g=(l=this._batman._oneShotFired)!=null?l[a]:void 0;if(typeof b!="function"){if(this.allowed(a)){if(f.isOneShot&&g)return!1;i=c!=null?c.apply(this,arguments):void 0,i!==!1&&(f._firedArgs=typeof i!="undefined"?(m=[i]).concat.apply(m,arguments):arguments.length===0?[]:Array.prototype.slice.call(arguments),e=Array.prototype.slice.call(f._firedArgs),e.unshift(a),this.fire.apply(this,e),f.isOneShot&&(h=(k=this._batman)._oneShotFired||(k._oneShotFired={}),h[a]=!0));return i}return!1}this.observe(a,b);if(f.isOneShot&&g)return b.apply(this,f._firedArgs)},b&&(f=f.bind(b)),a!=null&&(this[a]=f);return e(f,{isEvent:!0,action:c,isOneShot:this.isOneShot})}),eventOneShot:function(a){return e(j.EventEmitter.event.apply(this,arguments),{isOneShot:!0})}},b=function(a){var b;b=new j.Object;return b.event("_event",b,a)},c=function(a){var b;b=new j.Object;return b.eventOneShot("_event",b,a)},j._initializeObject=function(a){var b;if(a.prototype&&((b=a._batman)!=null?b.__initClass__:void 0)!==a)return a._batman={__initClass__:a};if(!a.hasOwnProperty("_batman"))return a._batman={}},j.Object=function(){function a(){var a;a=1<=arguments.length?x.call(arguments,0):[],j._initializeObject(this),this.mixin.apply(this,a)}a.global=function(a){if(a!==!1)return n[this.name]=this},a.property=function(a){return a},a.mixin=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return e.apply(null,[this].concat(x.call(a)))},a.prototype.mixin=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return e.apply(null,[this].concat(x.call(a)))},a.mixin(j.Observable,j.EventEmitter),a.prototype.mixin(j.Observable,j.EventEmitter);return a}(),j.Hash=function(){function a(){this._storage={}}z(a,j.Object),a.prototype.hasKey=function(a){return typeof this.get(a)!="undefined"},a.prototype._get=function(a){var b,c,d,e,f,g;if(b=this._storage[a])for(e=0,f=b.length;e<f;e++){g=b[e],c=g[0],d=g[1];if(this.equality(c,a))return d}},a.prototype._set=function(a,b){var c,d,e,f,g,h;d=(f=this._storage)[a]||(f[a]=[]);for(g=0,h=d.length;g<h;g++)c=d[g],this.equality(c[0],a)&&(e=c);e||(e=[a],d.push(e));return e[1]=b},a.prototype._unset=function(a){var b,c,d,e,f,g;if(c=this._storage[a])for(b=0,f=c.length;b<f;b++){g=c[b],d=g[0],e=g[1];if(this.equality(d,a)){c.splice(b,1);return}}},a.prototype.equality=function(a,b){return typeof a.isEqual=="function"?a.isEqual(b):typeof b.isEqual=="function"?b.isEqual(a):a===b},a.prototype.each=function(a){var b,c,d,e,f,g;f=this._storage,g=[];for(b in f)e=f[b],g.push(function(){var b,f,g,h;h=[];for(b=0,f=e.length;b<f;b++)g=e[b],c=g[0],d=g[1],h.push(a(c,d));return h}());return g},a.prototype.keys=function(){var a;a=[],this.each(function(b){return a.push(b)});return a};return a}(),j.Set=function(){function a(){this._storage=new j.Hash,this.length=0,this.add.apply(this,arguments)}z(a,j.Object),a.prototype.has=function(a){return this._storage.hasKey(a)},a.prototype.add=a.event(function(){var a,b,c,d;b=1<=arguments.length?x.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this._storage.hasKey(a)||(this._storage.set(a,!0),this.set("length",this.length+1));return b}),a.prototype.remove=a.event(function(){var a,b,c,d,e;b=1<=arguments.length?x.call(arguments,0):[],c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.set("length",this.length-1));return c}),a.prototype.each=function(a){return this._storage.each(function(b,c){return a(b)})},a.prototype.empty=a.property(function(){return this.get("length")===0}),a.prototype.toArray=function(){return this._storage.keys()};return a}(),j.SortableSet=function(){function a(b){a.__super__.constructor.apply(this,arguments),this._indexes={},this.addIndex(b)}z(a,j.Set),a.prototype.add=function(b){a.__super__.add.apply(this,arguments),this._reIndex();return b},a.prototype.remove=function(b){a.__super__.remove.apply(this,arguments),this._reIndex();return b},a.prototype.addIndex=function(a){this._reIndex(a);return this.activeIndex=a},a.prototype.removeIndex=function(a){this._indexes[a]=null,delete this._indexes[a];return a},a.prototype.each=function(a){var b,c,d,e,f;e=toArray(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(a(b));return f},a.prototype.toArray=function(){var b,c;return b=(c=this._indexes[this.activeIndex])!=null?c:{ary:a.__super__.toArray.apply(this,arguments)}},a.prototype._reIndex=function(a){var b,c,d,e,f;if(a){e=a.split(" "),c=e[0],d=e[1],b=j.Set.prototype.toArray.call(this);return this._indexes[a]=b.sort(function(a,b){var e,f,g,h,i;e=(g=(new j.Keypath(a,c)).resolve())!=null?g.valueOf():void 0,f=(h=(new j.Keypath(b,c)).resolve())!=null?h.valueOf():void 0,(d!=null?d.toLowerCase():void 0)==="desc"&&(i=[f,e],e=i[0],f=i[1]);return e<f?-1:e>f?1:0})}f=[];for(a in this._indexes)f.push(this._reIndex(a));return f};return a}(),j.TriggerSet=function(){function a(){a.__super__.constructor.apply(this,arguments),this.oldValues=new j.Hash}z(a,j.Set),a.prototype.keypaths=function(){var a;a=new j.Set,this.each(function(b){return a.add(b.targetKeypath)});return a},a.prototype.rememberOldValues=function(){var a;a=this.oldValues=new j.Hash;return this.keypaths().each(function(b){return a.set(b,b.resolve())})},a.prototype.fireAll=function(){return this.oldValues.each(function(a,b){return a.base.fire(a.path(),a.resolve(),b)})},a.prototype.refreshKeypathsWithTriggers=function(){return this.each(function(a){return j.Trigger.populateKeypath(a.targetKeypath,a.callback)})},a.prototype.removeTriggersNotInKeypath=function(){var a,b,c,d,e;d=this.toArray(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.isInKeypath()?void 0:a.remove());return e},a.prototype.removeTriggersWithInactiveObservers=function(){var a,b,c,d,e;d=this.toArray(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.hasActiveObserver()?void 0:a.remove());return e};return a}(),j.Request=function(){function a(){a.__super__.constructor.apply(this,arguments)}z(a,j.Object),a.prototype.url="",a.prototype.data="",a.prototype.method="get",a.prototype.response=null,a.prototype.observe("url",function(){return this._autosendTimeout=setTimeout(A(function(){return this.send()},this),0)}),a.prototype.loading=a.event(function(){}),a.prototype.loaded=a.event(function(){}),a.prototype.success=a.event(function(){}),a.prototype.error=a.event(function(){}),a.prototype.send=function(){throw"Please source a dependency file for a request implementation"},a.prototype.cancel=function(){if(this._autosendTimeout)return clearTimeout(this._autosendTimeout)};return a}(),j.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}z(a,j.Object),a.requirePath="",a.require=function(){var a,b,c,d,e,f;d=arguments[0],c=2<=arguments.length?x.call(arguments,1):[],a=this.requirePath+d;for(e=0,f=c.length;e<f;e++)b=c[e],this.prevent("run"),d=a+"/"+b+".coffee",new j.Request({url:d,type:"html",success:A(function(a){CoffeeScript.eval(a),this.allow("run");return this.run()},this)});return this},a.controller=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return this.require.apply(this,["controllers"].concat(x.call(a)))},a.model=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return this.require.apply(this,["models"].concat(x.call(a)))},a.view=function(){var a;a=1<=arguments.length?x.call(arguments,0):[];return this.require.apply(this,["views"].concat(x.call(a)))},a.layout=void 0,a.run=a.eventOneShot(function(){if(this.hasRun)return!1;j.currentApp=this,typeof this.layout=="undefined"&&this.set("layout",new j.View({node:document})),this.startRouting();return this.hasRun=!0});return a}(),s=/:([\w\d]+)/g,t=/\*([\w\d]+)/g,r=/[:|\*]([\w\d]+)/g,l=/[-[\]{}()+?.,\\^$|#\s]/g,j.Route={isRoute:!0,pattern:null,regexp:null,namedArguments:null,action:null,context:null,fire:function(a,b){var c,d,e,f;c=this.action;if(h(c)==="String"&&(f=c.indexOf("#"))!==-1){e=o.camelize(c.substr(0,f)+"Controller"),d=j.currentApp[e],b=d;if(b!=null?b.sharedInstance:void 0)b=b.sharedInstance();c=b[c.substr(f+1)]}if(c)return c.apply(b||this.context,a)},toString:function(){return"route: "+this.pattern}},e(j,{HASH_PATTERN:"#!",_routes:[],route:a(function(a,b){var c,d,f,g,h;d=function(b){var c,e,f;c=d.context||this,c&&c.sharedInstance&&(c=c.sharedInstance()),a=d.pattern;if(b&&!b.url)for(e in b)f=b[e],a=a.replace(new RegExp("[:|*]"+e),f);if(b&&!b.url||!b)j.currentApp._cachedRoute=a,window.location.hash=j.HASH_PATTERN+a;return c&&c.dispatch?c.dispatch.apply(c,[d].concat(x.call(args))):d.fire(arguments,c)},f=a.replace(l,"\\$&"),h=new RegExp("^"+f.replace(s,"([^/]*)").replace(t,"(.*?)")+"$"),g=[];while((c=r.exec(f))!=null)c[1]&&g.push(c[1]);e(d,j.Route,{pattern:f,regexp:h,namedArguments:g,action:b,context:this}),j._routes.push(d);return d}),redirect:function(a){var b;b=(a!=null?a.isRoute:void 0)?a.pattern:a;return window.location.hash=""+j.HASH_PATTERN+b}}),j.Object.route=j.App.route=g=j.route,j.Object.redirect=j.App.redirect=f=j.redirect,e(j.App,{startRouting:function(){var a,b;if(typeof window!="undefined"){b=A(function(){var a;a=window.location.hash.replace(j.HASH_PATTERN,"");if(a!==this._cachedRoute){this._cachedRoute=a;return this._dispatch(a)}},this),window.location.hash||(window.location.hash=""+j.HASH_PATTERN+"/"),setTimeout(b,0);if("onhashchange"in window){this._routeHandler=b;return window.addEventListener("hashchange",b)}a=window.location.hash;return this._routeHandler=setInterval(b,100)}},stopRouting:function(){if(this._routeHandler!=null){if("onhashchange"in window){window.removeEventListener("hashchange",this._routeHandler);return this._routeHandler=null}return this._routeHandler=clearInterval(this._routeHandler)}},_dispatch:function(a){var b,c;c=this._matchRoute(a);if(!c)a==="/404"?j.currentApp[404]():f("/404");else{b=this._extractParams(a,c);return c(b)}},_matchRoute:function(a){var b,c,d,e;e=j._routes;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.regexp.test(a))return b}return null},_extractParams:function(a,b){var c,d,e,f,g;c=b.regexp.exec(a).slice(1),f={url:a};for(d=0,g=c.length;d<g;d++)e=c[d],f[b.namedArguments[d]]=e;return f},root:function(a){return g("/",a)},404:function(){var a;return a=new j.View({html:"<h1>Page could not be found</h1>",contentFor:"main"})}}),j.Controller=function(){function a(){a.__super__.constructor.apply(this,arguments)}z(a,j.Object),a.sharedInstance=function(){this._sharedInstance||(this._sharedInstance=new this);return this._sharedInstance},a.beforeFilter=function(a){var b;b=this._beforeFilters||(this._beforeFilters=[]);return b.push(a)},a.resources=function(a){var b;b=A(function(){this.prototype.index&&(this.prototype.index=this.route("/"+a,this.prototype.index)),this.prototype.create&&(this.prototype.create=this.route("/"+a+"/new",this.prototype.create)),this.prototype.show&&(this.prototype.show=this.route("/"+a+"/:id",this.prototype.show));if(this.prototype.edit)return this.prototype.edit=this.route("/"+a+"/:id/edit",this.prototype.edit)},this);return setTimeout(b,0)},a.prototype.dispatch=function(){var a,b,c,e,f,g,h,i;g=arguments[0],e=2<=arguments.length?x.call(arguments,1):[],c=d(g,this),this._actedDuringAction=!1,this._currentAction=c,b=this.constructor._beforeFilters;if(b)for(h=0,i=b.length;h<i;h++)a=b[h],a.call(this);f=g.fire(e,this),this._actedDuringAction||this.render(),delete this._actedDuringAction;return delete this._currentAction},a.prototype.redirect=function(a){this._actedDuringAction=!0;return f(a)},a.prototype.render=function(a){var b;a==null&&(a={}),this._actedDuringAction=!0,a.view||(a.source=o.underscore(this.constructor.name.replace("Controller",""))+"/"+this._currentAction+".html",a.view=new j.View(a));if(b=a.view){b.context||(b.context=this);return b.ready(function(){return j.DOM.contentFor("main",b.get("node"))})}};return a}(),j.DataStore=function(){function a(a){this.model=a,this._data={}}z(a,j.Object),a.prototype.set=function(a,b){a||(a=model.getNewId());return this._data[""+a]=b},a.prototype.get=function(a){var b,c;b=this._data[""+a],c={},c[b.id]=b;return c},a.prototype.all=function(){return j.mixin({},this._data)},a.prototype.query=function(a){var b,c,d,e,f,g,h;f={},h=this._data;for(b in h){c=h[b],e=!0;for(d in a){g=a[d];if(c[d]!==g){e=!1;break}}e&&(f[b]=c)}return f};return a}(),j.Model=function(){function a(){this.destroy=A(this.destroy,this),this._data={},a.__super__.constructor.apply(this,arguments)}z(a,j.Object),a._makeRecords=function(a){var b,c,d,f;f=[];for(b in a)c=a[b],d=new this({id:b}),f.push(e(d,c));return f},a.hasMany=function(a){var b,c;c=o.camelize(o.singularize(a)),b=o.camelize(this.name,!0);return this.prototype[a]=j.Object.property(function(){var a;a={model:c},a[b+"Id"]=""+this.id;return App.constructor[c]._makeRecords(App.dataStore.query(a))})},a.hasOne=function(a){},a.belongsTo=function(a){var b,c;c=o.camelize(o.singularize(a)),b=o.camelize(c,!0)+"Id";return this.prototype[a]=j.Object.property(function(a){arguments.length&&this.set(b,a&&a.id?""+a.id:""+a);return App.constructor[c]._makeRecords(App.dataStore.query({model:c,id:this[b]}))[0]})},a.persist=function(a){if(a!==!1){this.dataStore||(this.dataStore=new j.DataStore(this));if(a!==j)return j.mixin(this,a)}},a.all=a.property(function(){return this._makeRecords(this.dataStore.all())}),a.first=a.property(function(){return this._makeRecords(this.dataStore.all())[0]}),a.last=a.property(function(){var a;a=this._makeRecords(this.dataStore.all());return a[a.length-1]}),a.find=function(a){return this._makeRecords(this.dataStore.get(a))[0]},a.create=j.Object.property(function(){return new this}),a.destroyAll=function(){var a,b,c,d,e;a=this.get("all"),e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(b.destroy());return e},a.prototype.id="",a.prototype.isEqual=function(a){return this.id===a.id},a.prototype.set=function(b,c){return this._data[b]=a.__super__.set.apply(this,arguments)},a.prototype.save=function(){var a;a=this.constructor,a.dataStore.set(this.id,this.toJSON());return this},a.prototype.destroy=function(){if(typeof this.id!="undefined"){App.dataStore.unset(this.id),App.dataStore.needsSync(),this.constructor.fire("all",this.constructor.get("all"));return this}},a.prototype.toJSON=function(){return this._data},a.prototype.fromJSON=function(a){return j.mixin(this,a)};return a}(),j.View=function(){function b(){b.__super__.constructor.apply(this,arguments)}var a;z(b,j.Object),a={},b.prototype.source="",b.prototype.html="",b.prototype.node=null,b.prototype.context=null,b.prototype.contexts=null,b.prototype.contentFor=null,b.prototype.ready=b.eventOneShot(function(){}),b.prototype.prefix="views",b.prototype.observe("source",function(){return setTimeout(A(function(){return this.reloadSource()},this),0)}),b.prototype.reloadSource=function(){var b;b=this.get("source");if(!!b)return a[b]?this.set("html",a[b]):new j.Request({url:"views/"+this.source,type:"html",success:A(function(c){a[b]=c;return this.set("html",c)},this),error:function(a){throw"Could not load view from "+url}})},b.prototype.observe("html",function(a){var b;b=this.node||document.createElement("div"),b.innerHTML=a;if(this.node!==b)return this.set("node",b)}),b.prototype.observe("node",function(a){if(!!a){this.ready.fired=!1,this._renderer&&this._renderer.forgetAll();if(a){this._renderer=new j.Renderer(a,A(function(){var b,c;b=this.contentFor,typeof b=="string"&&(this.contentFor=(c=j.DOM._yields)!=null?c[b]:void 0),this.contentFor&&a&&(this.contentFor.innerHTML="",this.contentFor.appendChild(a));return this.ready(a)},this),this.contexts),this.context&&this._renderer.contexts.push(this.context);return this._renderer.contextObject.view=this}}});return b}(),j.Renderer=function(){function b(a,c,d){this.node=a,this.callback=c,this.resume=A(this.resume,this),this.start=A(this.start,this),b.__super__.constructor.apply(this,arguments),this.contexts=d||[j.currentApp,new j.Object],this.contextObject=this.contexts[1],setTimeout(this.start,0)}var a;z(b,j.Object),b.prototype.start=function(){this.startTime=new Date;return this.parseNode(this.node)},b.prototype.resume=function(){this.startTime=new Date;return this.parseNode(this.resumeNode)},b.prototype.finish=function(){this.startTime=null;return typeof this.callback=="function"?this.callback():void 0},b.prototype.forgetAll=function(){},a=/data\-(.*)/,b.prototype.parseNode=function(b){var c,d,e,f,g,h,i,k,l,m,n,o,p,q;if(new Date-this.startTime>50)this.resumeNode=b,setTimeout(this.resume,0);else{if(b.getAttribute){this.contextObject.node=b,d=this.contexts,p=b.attributes;for(m=0,n=p.length;m<n;m++){c=p[m],f=(q=c.nodeName.match(a))!=null?q[1]:void 0;if(!f)continue;h=(e=f.indexOf("-"))===-1?typeof (k=j.DOM.readers)[f]=="function"?k[f](b,c.value,d,this):void 0:typeof (l=j.DOM.attrReaders)[o=f.substr(0,e)]=="function"?l[o](b,f.substr(e+1),c.value,d,this):void 0;if(h===!1){i=!0;break}}}return(g=this.nextNode(b,i))?this.parseNode(g):this.finish()}},b.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}typeof a.onParseExit=="function"&&a.onParseExit(),f=a.nextSibling;if(f)return f;d=a;while(d=d.parentNode){typeof d.onParseExit=="function"&&d.onParseExit(),e=d.nextSibling;if(e)return e}};return b}(),p=function(a,b){var c,d,e;c=b.split(".")[0],e=a.length;while(e--){d=a[e];if(d.get!=null&&d.get(c)!=null||d[c]!=null)return d}return n},j.DOM={readers:{bind:function(a,b,c){var d,e;d=p(c,b),e=!0,j.DOM.nodeIsEditable(a)&&j.DOM.events.change(a,function(){e=!1,d.set(b,a.value);return e=!0});return d.observe(b,!0,function(b){if(e)return j.DOM.valueForNode(a,b)})},context:function(a,b,c){var d;d=p(c,b).get(b),c.push(d);return a.onParseExit=function(){var a;a=c.indexOf(d);return c.splice(a,c.length-a)}},mixin:function(a,b,c){var d,f;c.push(j.mixins),d=p(c,b),f=d.get(b),c.pop();return e(a,f)},showif:function(a,b,c,d,e){var f,g;g=a.style.display;if(!g||g==="none")g="block";f=p(c,b);return f.observe(b,!0,function(b){return!!b==!e?typeof a.show=="function"?a.show():a.style.display=g:typeof a.hide=="function"?a.hide():a.style.display="none"})},hideif:function(){var a,b;a=1<=arguments.length?x.call(arguments,0):[];return(b=j.DOM.readers).showif.apply(b,x.call(a).concat([!0]))},route:function(a,b,c){var d,e,f,g,h,i,k,l;b.substr(0,1)==="/"?(i=j.redirect.bind(j,b),k=b):(h=b.indexOf("#"))!==-1?(f=o.camelize(b.substr(0,h))+"Controller",d=p(c,f),e=d[f],i=e!=null?e.sharedInstance()[b.substr(h+1)]:void 0,k=i!=null?i.pattern:void 0):(d=p(c,b),i=d.get(b),i instanceof j.Model?(f=o.camelize(o.pluralize(b))+"Controller",d=p(c,f),e=d[f].sharedInstance(),g=i.id,i=(l=e.show)!=null?l.bind(e,{id:g}):void 0,k="/"+o.pluralize(b)+"/"+g):k=i!=null?i.pattern:void 0),a.nodeName.toUpperCase()==="A"&&(a.href=j.HASH_PATTERN+(k||""));return j.DOM.events.click(a,function(){return i()})},partial:function(a,b,c){var d;return d=new j.View({source:b+".html",contentFor:a,contexts:Array.prototype.slice.call(c)})},yield:function(a,b){return setTimeout(function(){return j.DOM.yield(b,a)},0)},contentfor:function(a,b){return setTimeout(function(){return j.DOM.contentFor(b,a)},0)}},attrReaders:{bind:function(a,b,c,d){var e,f,g,h,i,k;h=c.split(/\s*\|\s*/),c=h.shift();if(h.length){k=[];while(g=h.shift()){f=j.filters[g]||j.helpers[g];if(!f)continue;i=f.apply(null,[c].concat(x.call(args),[a])),k.push(a.setAttribute(b,i))}return k}e=p(d,c),e.observe(c,!0,function(c){return b==="value"?a.value=c:a.setAttribute(b,c)});if(b==="value")return j.DOM.events.change(a,function(){i=a.value,i==="false"&&(i=!1),i==="true"&&(i=!0);return e.set(c,i)})},context:function(a,b,c,d){var e,f;e=p(d,c).get(c),f=new j.Object,f[b]=e,d.push(f);return a.onParseExit=function(){var a;a=d.indexOf(e);return d.splice(a,d.length-a)}},event:function(a,b,c,d){var e,f;c.substr(0,1)==="@"?e=new Function(c.substr(1)):(f=p(d,c),e=f.get(c));return j.DOM.events[b](a,function(){var b;b=a.getAttribute("data-confirm");if(!b||!!confirm(b))return e!=null?e.apply(f,arguments):void 0})},addclass:function(a,b,c,d,e,f){var g;b=b.replace(/\|/g," "),g=p(d,c);return g.observe(c,!0,function(c){var d,e;d=a.className,e=d.indexOf(b)!==-1;if(!!c==!f){if(!e)return a.className=""+d+" "+b}else if(e)return a.className=d.replace(b,"")})},removeclass:function(){var a,b;a=1<=arguments.length?x.call(arguments,0):[];return(b=j.DOM.attrReaders).addclass.apply(b,x.call(a).concat([!0]))},foreach:function(a,b,c,d,e){var f,g,h,i,k,l,m,n;m=a.cloneNode(!0),m.removeAttribute("data-foreach-"+b),l=a.parentNode,l.removeChild(a),k=new j.Hash,i=Array.prototype.slice.call(d),h=p(d,c),g=h.get(c),g.observe("add",f=function(a){var c,d,f,g;f=m.cloneNode(!0),k.set(a,f),g=new j.Renderer(f,function(){l.appendChild(f);return e.allow("ready")}),g.contexts=d=Array.prototype.slice.call(i),g.contextObject=j(d[1]),c=new j.Object,c[b]=a,d.push(c);return d.push(a)}),g.observe("remove",n=function(a){var b,c;b=k.get(a);return b!=null?(c=b.parentNode)!=null?c.removeChild(b):void 0:void 0}),g.observe("sort",function(){g.each(n);return setTimeout(function(){return g.each(f)},0)}),g.each(function(a){e.prevent("ready");return f(a)});return!1}},events:{click:function(a,b){j.DOM.addEventListener(a,"click",function(a){b!=null&&b.apply(this,arguments);return a.preventDefault()});if(a.nodeName.toUpperCase()==="A"&&!a.href)return a.href="#"},change:function(a,b){var c;c=function(){switch(a.nodeName.toUpperCase()){case"TEXTAREA":return"keyup";case"INPUT":return a.type.toUpperCase()==="TEXT"?"keyup":"change";default:return"change"}}();return j.DOM.addEventListener(a,c,b)},submit:function(a,b){return j.DOM.nodeIsEditable(a)?j.DOM.addEventListener(a,"keyup",function(a){if(a.keyCode===13){b.apply(this,arguments);return a.preventDefault()}}):j.DOM.addEventListener(a,"submit",function(a){b.apply(this,arguments);return a.preventDefault()})}},yield:function(a,b){var c,d,e,f;d=(e=j.DOM)._yields||(e._yields={}),d[a]=b;if(c=(f=j.DOM._yieldContents)!=null?f[a]:void 0){b.innerHTML="";if(c)return b.appendChild(c)}},contentFor:function(a,b){var c,d,e,f;c=(e=j.DOM)._yieldContents||(e._yieldContents={}),c[a]=b;if(d=(f=j.DOM._yields)!=null?f[a]:void 0){d.innerHTML="";if(b)return d.appendChild(b)}},valueForNode:function(a,b){var c;c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;default:return c?a.innerHTML=b:a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"},addEventListener:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}},k=/(?:^|_)(.)/g,u=/([A-Z]+)([A-Z][a-z])/g,v=/([a-z\d])([A-Z])/g,o=j.helpers={camelize:function(a,b){a=a.replace(k,function(a,b){return b.toUpperCase()});return b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(u,"$1_$2").replace(v,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){return a.substr(-1)==="s"?a.substr(0,a.length-1):a},pluralize:function(a,b){if(b){if(a===1)return b}else b=a;return b.substr(-1)==="y"?""+b.substr(0,b.length-1)+"ies":""+b+"s"}},m=j.filters={},q=j.mixins=new j.Object,n=typeof window!="undefined"&&window!==null?window:n,e(n,j.Observable),typeof exports!="undefined"&&exports!==null&&(exports.Batman=j),j.exportHelpers=function(a){a.$typeOf=h,a.$mixin=e,a.$unmixin=i,a.$route=g,a.$redirect=f,a.$event=b;return a.$eventOneShot=c},j.exportGlobals=function(){return j.exportHelpers(n)},j.Request.prototype.send=function(a){return jQuery.ajax(this.get("url"),{type:this.get("method"),dataType:this.get("type"),data:a||this.get("data"),beforeSend:A(function(){return this.loading(!0)},this),success:A(function(a){this.set("response",a);return this.success(a)},this),error:A(function(a,b,c){this.set("response",c);return this.error(c)},this),complete:A(function(){this.loading(!1);return this.loaded(!0)},this)})}}).call(this)