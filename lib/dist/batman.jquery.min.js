(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=Array.prototype.slice,Q=Object.prototype.hasOwnProperty,R=function(a,b){function d(){this.constructor=a}for(var c in b)Q.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},S=function(a,b){return function(){return a.apply(b,arguments)}},T=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};l=function(){var a;a=1<=arguments.length?P.call(arguments,0):[];return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(l.Object,a,function(){})},l.typeOf=i=function(a){return L.call(a).slice(8,-1)},L=Object.prototype.toString,l.undef=j=function(a){return typeof a=="undefined"},l.mixin=f=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2<=arguments.length?P.call(arguments,1):[],a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(i(c)!=="Object")continue;for(b in c){if(!Q.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e[b]=f}}return e},l.unmixin=k=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?P.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.deinitialize=="function"&&c.deinitialize.call(a)}return a},l._block=a=function(a,b){var c,d;b!=null?c=a:b=a;return d=function(){var a,d,e;a=1<=arguments.length?P.call(arguments,0):[],d=this,e=function(c){a.push(c);return b.apply(d,a)};return typeof a[a.length-1]=="function"||c&&a.length>=c?e(a.pop()):e}},l._findName=d=function(a,b){var c,d;if(!a.displayName)for(c in b){d=b[c];if(d===a){a.displayName=c;break}}return a.displayName},l.Property=function(){function a(a,b){this.base=a,this.key=b}a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){return delete this[a]}},a.triggerTracker=null,a["for"]=function(a,b){var c,d;if(a._batman){l.initializeObject(a),c=(d=a._batman).properties||(d.properties=new l.SimpleHash);return c.get(b)||c.set(b,new this(a,b))}return new this(a,b)},a.prototype.isProperty=!0,a.prototype.accessor=function(){var a,b,c,d;a=(c=this.base._batman)!=null?c.get("keyAccessors"):void 0;return a&&(b=a.get(this.key))?b:((d=this.base._batman)!=null?d.getFirst("defaultAccessor"):void 0)||l.Property.defaultAccessor},a.prototype.registerAsTrigger=function(){var a;if(a=l.Property.triggerTracker)return a.add(this)},a.prototype.getValue=function(){var a;this.registerAsTrigger();return(a=this.accessor())!=null?a.get.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b;return(b=this.accessor())!=null?b.set.call(this.base,this.key,a):void 0},a.prototype.unsetValue=function(){var a;return(a=this.accessor())!=null?a.unset.call(this.base,this.key):void 0},a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key};return a}(),l.ObservableProperty=function(){function a(b,c){a.__super__.constructor.apply(this,arguments),this.observers=new l.SimpleSet,this.hasObserversToFire()&&this.refreshTriggers(),this._preventCount=0}R(a,l.Property),a.prototype.setValue=function(b){this.cacheDependentValues(),a.__super__.setValue.apply(this,arguments),this.fireDependents();return b},a.prototype.unsetValue=function(){this.cacheDependentValues(),a.__super__.unsetValue.apply(this,arguments),this.fireDependents()},a.prototype.cacheDependentValues=function(){if(this.dependents)return this.dependents.each(function(a){return a.cachedValue=a.getValue()})},a.prototype.fireDependents=function(){if(this.dependents)return this.dependents.each(function(a){if(typeof a.hasObserversToFire=="function"?a.hasObserversToFire():void 0)return a.fire(a.getValue(),a.cachedValue)})},a.prototype.observe=function(){var a,b,c,d;c=2<=arguments.length?P.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],c=c[0]===!0,b=this.getValue(),this.observers.add(a),this.refreshTriggers(),c&&a.call(this.base,b,b);return this},a.prototype.hasObserversToFire=function(){if(this.observers.length>0)return!0;return this.base._batman!=null?this.base._batman.ancestors().some(S(function(a){var b,c;return(typeof a.property=="function"?(b=a.property(this.key))!=null?(c=b.observers)!=null?c.length:void 0:void 0:void 0)>0},this)):!1},a.prototype.prevent=function(){return this._preventCount++},a.prototype.allow=function(){if(this._preventCount>0)return this._preventCount--},a.prototype.isAllowedToFire=function(){return this._preventCount<=0},a.prototype.fire=function(){var a,b,c,d;a=1<=arguments.length?P.call(arguments,0):[];if(!!this.hasObserversToFire()){c=this.key,b=this.base,d=[this.observers].concat(this.base._batman.ancestors(function(a){return typeof a.property=="function"?a.property(c).observers:void 0})).reduce(function(a,b){return a.merge(b)}),d.each(function(c){return c!=null?c.apply(b,a):void 0});return this.refreshTriggers()}},a.prototype.forget=function(a){a?this.observers.remove(a):this.observers=new l.SimpleSet;if(!this.hasObserversToFire())return this.clearTriggers()},a.prototype.refreshTriggers=function(){l.Property.triggerTracker=new l.SimpleSet,this.getValue(),this.triggers&&this.triggers.each(S(function(a){var b;if(!l.Property.triggerTracker.has(a))return(b=a.dependents)!=null?b.remove(this):void 0},this)),this.triggers=l.Property.triggerTracker,this.triggers.each(S(function(a){a.dependents||(a.dependents=new l.SimpleSet);return a.dependents.add(this)},this));return delete l.Property.triggerTracker},a.prototype.clearTriggers=function(){this.triggers.each(S(function(a){return a.dependents.remove(this)},this));return this.triggers=new l.SimpleSet};return a}(),l.Keypath=function(){function a(b,c){i(c)==="String"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),a.__super__.constructor.apply(this,arguments)}R(a,l.ObservableProperty),a.prototype.slice=function(a,b){var c,d,e,f,g;c=this.base,g=this.segments.slice(0,a);for(e=0,f=g.length;e<f;e++){d=g[e];if(c==null||!(c=l.Keypath["for"](c,d).getValue()))return}return l.Keypath["for"](c,this.segments.slice(a,b).join("."))},a.prototype.terminalProperty=function(){return this.slice(-1)},a.prototype.getValue=function(){var b;this.registerAsTrigger();return this.depth===1?a.__super__.getValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.getValue():void 0},a.prototype.setValue=function(b){var c;return this.depth===1?a.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(b):void 0},a.prototype.unsetValue=function(){var b;return this.depth===1?a.__super__.unsetValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.unsetValue():void 0};return a}(),l.Observable={isObservable:!0,property:function(a){l.initializeObject(this);return l.Keypath["for"](this,a)},get:function(a){if(!j(a))return this.property(a).getValue()},set:function(a,b){if(!j(a))return this.property(a).setValue(b)},unset:function(a){if(!j(a))return this.property(a).unsetValue()},forget:function(a,b){a?this.property(a).forget(b):this._batman.properties.each(function(a,b){return b.forget()});return this},allowed:function(a){return this.property(a).isAllowedToFire()}},M=["observe","prevent","allow","fire"],G=function(a){return l.Observable[a]=function(){var b,c,d;c=arguments[0],b=2<=arguments.length?P.call(arguments,1):[],(d=this.property(c))[a].apply(d,b);return this}};for(H=0,J=M.length;H<J;H++)w=M[H],G(w);e=l.get=function(a,b){return a.get?a.get(b):l.Observable.get.call(a,b)},l.EventEmitter={event:a(function(a,b,c){var e;!c&&!j(b)&&(c=b,b=null),!c&&i(a)!=="String"&&(c=a,a=null),e=function(b){var f,g,h,i,k,m,n;if(!this.observe)throw"EventEmitter requires Observable";l.initializeObject(this),a||(a=d(e,this)),g=(m=this._batman._oneShotFired)!=null?m[a]:void 0;if(typeof b!="function"){if(this.allowed(a)){if(e.isOneShot&&g)return!1;i=c!=null?c.apply(this,arguments):void 0,i!==!1&&(e._firedArgs=j(i)?arguments.length===0?[]:Array.prototype.slice.call(arguments):(n=[i]).concat.apply(n,arguments),f=Array.prototype.slice.call(e._firedArgs),f.unshift(a),this.fire.apply(this,f),e.isOneShot&&(h=(k=this._batman)._oneShotFired||(k._oneShotFired={}),h[a]=!0));return i}return!1}this.observe(a,b);if(e.isOneShot&&g)return b.apply(this,e._firedArgs)},b&&(e=e.bind(b)),a!=null&&(this[a]=e);return f(e,{isEvent:!0,action:c,isOneShot:this.isOneShot})}),eventOneShot:function(a){return f(l.EventEmitter.event.apply(this,arguments),{isOneShot:!0})}},l.event=b=function(a){var b;b=new l.Object;return b.event("_event",b,a)},l.eventOneShot=c=function(a){var b;b=new l.Object;return b.eventOneShot("_event",b,a)},l.StateMachine={initialize:function(){l.initializeObject(this);if(!this._batman.states){this._batman.states=new l.SimpleHash;return this.accessor("state",{get:function(){return this.state()},set:function(a,b){return O.call(this,b)}})}},state:function(a,b){var c;l.StateMachine.initialize.call(this);if(!a)return this._batman.getFirst("state");if(!this.event)throw"StateMachine requires EventEmitter";c=this[a]||this.event(a,function(){O.call(this,a);return!1}),typeof b=="function"&&c.call(this,b);return c},transition:function(a,c,d){var e,f,g;l.StateMachine.initialize.call(this),this.state(a),this.state(c),f=""+a+"->"+c,g=this._batman.states,e=g.get(f)||g.set(f,b(function(){})),d&&e(d);return e}},O=function(a){var b,c,d,e,f,g,h,i;l.StateMachine.initialize.call(this);if(this._batman.isTransitioning){((e=this._batman).nextState||(e.nextState=[])).push(a);return!1}this._batman.isTransitioning=!0,d=this.state(),this._batman.state=a;if(a&&d){c=""+d+"->"+a,h=this._batman.getAll(function(a){var b,d;return(b=a._batman)!=null?(d=b.get("states"))!=null?d.get(c):void 0:void 0});for(f=0,g=h.length;f<g;f++)b=h[f],b&&b(a,d)}a&&this.fire(a,a,d),this._batman.isTransitioning=!1,((i=this._batman.nextState)!=null?i.length:void 0)&&this[this._batman.nextState.shift()]();return a},l.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new E(a)},l._Batman=E=function(){function a(){var a,b;b=arguments[0],a=2<=arguments.length?P.call(arguments,1):[],this.object=b,a.length>0&&f.apply(null,[this].concat(P.call(a)))}a.prototype.check=function(b){if(b!==this.object)return b._batman=new a(b)},a.prototype.get=function(a){var b;b=this.getAll(a);switch(b.length){case 0:return;case 1:return b[0];default:b[0].concat!=null?b=b.reduceRight(function(a,b){return a.concat(b)}):b[0].merge!=null&&(b=b.reduceRight(function(a,b){return a.merge(b)}));return b}},a.prototype.getFirst=function(a){var b;b=this.getAll(a);return b[0]},a.prototype.getAll=function(a){var b,c,d;typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d);return c},a.prototype.ancestors=function(a){var b,c,d,e,f,g;a==null&&(a=function(a){return a}),e=[],c=!!this.object.prototype,d=c?(g=this.object.__super__)!=null?g.constructor:void 0:(b=this.object.constructor).prototype===this.object?b.__super__:b.prototype,d!=null&&(f=a(d),f!=null&&e.push(f),d._batman!=null&&(e=e.concat(d._batman.ancestors(a))));return e},a.prototype.set=function(a,b){return this[a]=b};return a}(),l.Object=function(){function a(){var a;a=1<=arguments.length?P.call(arguments,0):[],this._batman=new E(this),this.mixin.apply(this,a)}a.global=function(a){if(a!==!1)return s[this.name]=this},a.classMixin=function(){return f.apply(null,[this].concat(P.call(arguments)))},a.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},a.prototype.mixin=a.classMixin,a.classAccessor=function(){var a,b,c,d,e,f,g,h,i,j,k;c=2<=arguments.length?P.call(arguments,0,g=arguments.length-1):(g=0,[]),a=arguments[g++],l.initializeObject(this);if(c.length===0){if(a.get||a.set)return this._batman.defaultAccessor=a;(e=this._batman).keyAccessors||(e.keyAccessors=new l.SimpleHash),j=[];for(b in a)d=a[b],this._batman.keyAccessors.set(b,{get:d,set:d}),j.push(this[b]=d);return j}(f=this._batman).keyAccessors||(f.keyAccessors=new l.SimpleHash),k=[];for(h=0,i=c.length;h<i;h++)b=c[h],k.push(this._batman.keyAccessors.set(b,a));return k},a.accessor=function(){return this.classAccessor.apply(this.prototype,arguments)},a.prototype.accessor=a.classAccessor,a.classMixin(l.Observable,l.EventEmitter),a.mixin(l.Observable,l.EventEmitter),a.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},a.becomeStateMachine=function(a){a==null&&(a=!0),l.StateMachine.initialize.call(this),l.StateMachine.initialize.call(this.prototype),this.classState=function(){return l.StateMachine.state.apply(this,arguments)},this.state=function(){return this.classState.apply(this.prototype,arguments)},a&&(this.prototype.state=this.classState),this.classTransition=function(){return l.StateMachine.transition.apply(this,arguments)},this.transition=function(){return this.classTransition.apply(this.prototype,arguments)};if(a)return this.prototype.transition=this.classTransition};return a}(),l.SimpleHash=function(){function a(){this._storage={},this.length=0}a.prototype.hasKey=function(a){return!j(this.get(a))},a.prototype.get=function(a){var b,c,d,e,f,g;if(!j(a))if(b=this._storage[a])for(e=0,f=b.length;e<f;e++){g=b[e],c=g[0],d=g[1];if(this.equality(c,a))return d}},a.prototype.set=function(a,b){var c,d,e,f,g,h;if(!j(a)){if(j(b))return this.unset(a);d=(f=this._storage)[a]||(f[a]=[]);for(g=0,h=d.length;g<h;g++){c=d[g];if(this.equality(c[0],a)){e=c;break}}e||(e=[a],d.push(e),this.length++);return e[1]=b}},a.prototype.unset=function(a){var b,c,d,e,f,g;if(c=this._storage[a])for(b=0,f=c.length;b<f;b++){g=c[b],d=g[0],e=g[1];if(this.equality(d,a)){c.splice(b,1),this.length--;return}}},a.prototype.equality=function(a,b){if(j(a)||j(b))return!1;return typeof a.isEqual=="function"?a.isEqual(b):typeof b.isEqual=="function"?b.isEqual(a):a===b},a.prototype.each=function(a){var b,c,d,e,f,g;f=this._storage,g=[];for(b in f)e=f[b],g.push(function(){var b,f,g,h;h=[];for(b=0,f=e.length;b<f;b++)g=e[b],c=g[0],d=g[1],h.push(a(c,d));return h}());return g},a.prototype.keys=function(){var a;a=[],this.each(function(b){return a.push(b)});return a},a.prototype.clear=function(){this._storage={};return this.length=0},a.prototype.isEmpty=function(){return this.length===0},a.prototype.merge=function(){var a,b,c,d,e;c=1<=arguments.length?P.call(arguments,0):[],b=new this.constructor,c.unshift(this);for(d=0,e=c.length;d<e;d++)a=c[d],a.each(function(a,c){return b.set(a,c)});return b};return a}(),l.Hash=function(){function e(){l.SimpleHash.apply(this,arguments),e.__super__.constructor.apply(this,arguments)}var a,b,c,d;R(e,l.Object),e.accessor({get:l.SimpleHash.prototype.get,set:l.SimpleHash.prototype.set,unset:l.SimpleHash.prototype.unset}),e.accessor("isEmpty",{get:function(){return this.isEmpty()}}),d=["hasKey","equality","each","keys","merge","clear","isEmpty"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype[a]=l.SimpleHash.prototype[a];return e}(),l.SimpleSet=function(){function a(){this._storage=new l.SimpleHash,this.length=0,arguments.length>0&&this.add.apply(this,arguments)}a.prototype.has=function(a){return this._storage.hasKey(a)},a.prototype.add=function(){var a,b,c,d,e;c=1<=arguments.length?P.call(arguments,0):[],a=[];for(d=0,e=c.length;d<e;d++)b=c[d],this._storage.hasKey(b)||(this._storage.set(b,!0),a.push(b),this.length++);a.length!==0&&this.itemsWereAdded.apply(this,a);return a},a.prototype.remove=function(){var a,b,c,d,e;b=1<=arguments.length?P.call(arguments,0):[],c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.length--);c.length!==0&&this.itemsWereRemoved.apply(this,c);return c},a.prototype.each=function(a){return this._storage.each(function(b,c){return a(b)})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.clear=function(){return this.remove(this.toArray())},a.prototype.toArray=function(){return this._storage.keys()},a.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?P.call(arguments,0):[],a=new this.constructor,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.each(function(b){return a.add(b)});return a},a.prototype.itemsWereAdded=function(){},a.prototype.itemsWereRemoved=function(){};return a}(),l.Set=function(){function e(){e.__super__.constructor.apply(this,arguments),F.apply(this,arguments)}var a,b,c,d;R(e,l.Object),F=l.SimpleSet,e.prototype.itemsWereAdded=e.event(function(){}),e.prototype.itemsWereRemoved=e.event(function(){}),d=["add","remove","has","each","isEmpty","toArray","clear","merge"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype[a]=l.SimpleSet.prototype[a];e.accessor("isEmpty",{get:function(){return this.isEmpty()}});return e}(),l.SortableSet=function(){function a(){a.__super__.constructor.apply(this,arguments),this._indexes={},this.observe("activeIndex",S(function(){return this.setWasSorted(this)},this))}R(a,l.Set),a.prototype.setWasSorted=a.event(function(){if(this.length===0)return!1}),a.prototype.add=function(){var a;a=l.SimpleSet.prototype.add.apply(this,arguments),this._reIndex();return a},a.prototype.remove=function(){var a;a=l.SimpleSet.prototype.remove.apply(this,arguments),this._reIndex();return a},a.prototype.addIndex=function(a){return this._reIndex(a)},a.prototype.removeIndex=function(a){this._indexes[a]=null,delete this._indexes[a],this.activeIndex===a&&this.unset("activeIndex");return a},a.prototype.each=function(a){var b,c,d,e,f;e=this.toArray(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(a(b));return f},a.prototype.sortBy=function(a){this._indexes[a]||this.addIndex(a),this.activeIndex!==a&&this.set("activeIndex",a);return this},a.prototype.toArray=function(){var b;return(b=this._indexes[this.get("activeIndex")])!=null?b:a.__super__.toArray.apply(this,arguments)},a.prototype._reIndex=function(a){var b,c,d,e;if(a)e=a.split(" "),c=e[0],d=e[1],b=l.Set.prototype.toArray.call(this),this._indexes[a]=b.sort(function(a,b){var e,f,g,h,i;e=(g=l.Observable.property.call(a,c).getValue())!=null?g.valueOf():void 0,f=(h=l.Observable.property.call(b,c).getValue())!=null?h.valueOf():void 0,(d!=null?d.toLowerCase():void 0)==="desc"&&(i=[f,e],e=i[0],f=i[1]);return e<f?-1:e>f?1:0}),this.activeIndex===a&&this.setWasSorted(this);else{for(a in this._indexes)this._reIndex(a);this.setWasSorted(this)}return this};return a}(),l.Request=function(){function a(){a.__super__.constructor.apply(this,arguments)}R(a,l.Object),a.prototype.url="",a.prototype.data="",a.prototype.method="get",a.prototype.response=null,a.observeAll("url",function(){return this._autosendTimeout=setTimeout(S(function(){return this.send()},this),0)}),a.prototype.loading=a.event(function(){}),a.prototype.loaded=a.event(function(){}),a.prototype.success=a.event(function(){}),a.prototype.error=a.event(function(){}),a.prototype.send=function(){throw"Please source a dependency file for a request implementation"},a.prototype.cancel=function(){if(this._autosendTimeout)return clearTimeout(this._autosendTimeout)};return a}(),l.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}R(a,l.Object),a.requirePath="",a.require=function(){var a,b,c,d,e,f;d=arguments[0],c=2<=arguments.length?P.call(arguments,1):[],a=this.requirePath+d;for(e=0,f=c.length;e<f;e++)b=c[e],this.prevent("run"),d=a+"/"+b+".coffee",new l.Request({url:d,type:"html",success:S(function(a){CoffeeScript.eval(a),this.allow("run");return this.run()},this)});return this},a.controller=function(){var a;a=1<=arguments.length?P.call(arguments,0):[];return this.require.apply(this,["controllers"].concat(P.call(a)))},a.model=function(){var a;a=1<=arguments.length?P.call(arguments,0):[];return this.require.apply(this,["models"].concat(P.call(a)))},a.view=function(){var a;a=1<=arguments.length?P.call(arguments,0):[];return this.require.apply(this,["views"].concat(P.call(a)))},a.layout=void 0,a.run=a.eventOneShot(function(){if(this.hasRun)return!1;l.currentApp=this,j(this.layout)&&this.set("layout",new l.View({node:document,contexts:[this]})),this.startRouting();return this.hasRun=!0});return a}(),z=/:([\w\d]+)/g,B=/\*([\w\d]+)/g,A="(?:\\?.+)?",y=/[:|\*]([\w\d]+)/g,t=/[-[\]{}()+?.,\\^$|#\s]/g,l.Route={isRoute:!0,pattern:null,regexp:null,namedArguments:null,action:null,context:null,fire:function(a,b){var c,d,e,f;c=this.action;if(i(c)==="String"&&(f=c.indexOf("#"))!==-1){e=v.camelize(c.substr(0,f)+"Controller"),d=l.currentApp[e],b=d;if(b!=null?b.sharedInstance:void 0)b=b.sharedInstance();c=b[c.substr(f+1)]}if(c)return c.apply(b||this.context,a)},toString:function(){return"route: "+this.pattern}},f(l,{HASH_PATTERN:"#!",_routes:[],route:a(2,function(a,b){var c,d,e,g,h;d=function(b){var c,e,f,g,h;i(d.action)==="String"&&(c=d.action.split("#"),f=l.currentApp[v.camelize(c[0])+"Controller"],f&&(d.context=f,d.action=f.prototype[c[1]])),e=d.context||this,e&&e.sharedInstance&&(e=e.sharedInstance()),a=d.pattern;if(b&&!b.url)for(g in b)h=b[g],a=a.replace(new RegExp("[:|*]"+g),h);if(b&&!b.url||!b)l.currentApp._cachedRoute=a,window.location.hash=l.HASH_PATTERN+a;return e&&e.dispatch?e.dispatch(d,b):d.fire(arguments,e)},e=a.replace(t,"\\$&"),h=new RegExp("^"+e.replace(z,"([^/]*)").replace(B,"(.*?)")+A+"$"),g=[];while((c=y.exec(e))!=null)c[1]&&g.push(c[1]);f(d,l.Route,{pattern:e,regexp:h,namedArguments:g,action:b,context:this}),l._routes.push(d);return d}),redirect:function(a){var b;b=(a!=null?a.isRoute:void 0)?a.pattern:a;return window.location.hash=""+l.HASH_PATTERN+b}}),l.Object.route=l.App.route=h=l.route,l.Object.redirect=l.App.redirect=g=l.redirect,f(l.App,{startRouting:function(){var a,b;if(!j(window)){b=S(function(){var a;a=window.location.hash.replace(l.HASH_PATTERN,"");if(a!==this._cachedRoute){this._cachedRoute=a;return this._dispatch(a)}},this),window.location.hash||(window.location.hash=""+l.HASH_PATTERN+"/"),setTimeout(b,0);if("onhashchange"in window){this._routeHandler=b;return window.addEventListener("hashchange",b)}a=window.location.hash;return this._routeHandler=setInterval(b,100)}},stopRouting:function(){if(this._routeHandler!=null){if("onhashchange"in window){window.removeEventListener("hashchange",this._routeHandler);return this._routeHandler=null}return this._routeHandler=clearInterval(this._routeHandler)}},_dispatch:function(a){var b,c;c=this._matchRoute(a);if(!c)a==="/404"?l.currentApp[404]():g("/404");else{b=this._extractParams(a,c);return c(b)}},_matchRoute:function(a){var b,c,d,e;e=l._routes;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.regexp.test(a))return b}return null},_extractParams:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;m=a.split("?"),a=m[0],g=m[1],c=b.regexp.exec(a).slice(1),f={url:a};for(d=0,k=c.length;d<k;d++)e=c[d],f[b.namedArguments[d]]=e;if(g!=null){n=g.split("&");for(j=0,l=n.length;j<l;j++)h=n[j],o=h.split("="),w=o[0],i=o[1],f[w]=i}return f},root:function(a){return h("/",a)},404:function(){var a;return a=new l.View({html:"<h1>Page could not be found</h1>",contentFor:"main"})}}),l.Controller=function(){function a(){a.__super__.constructor.apply(this,arguments)}R(a,l.Object),a.sharedInstance=function(){this._sharedInstance||(this._sharedInstance=new this);return this._sharedInstance},a.beforeFilter=function(a){var b;b=this._beforeFilters||(this._beforeFilters=[]);return b.push(a)},a.resources=function(a){var b;b=S(function(){this.prototype.index&&(this.prototype.index=this.route("/"+a,this.prototype.index)),this.prototype.create&&(this.prototype.create=this.route("/"+a+"/new",this.prototype.create)),this.prototype.show&&(this.prototype.show=this.route("/"+a+"/:id",this.prototype.show));if(this.prototype.edit)return this.prototype.edit=this.route("/"+a+"/:id/edit",this.prototype.edit)},this);return setTimeout(b,0)},a.prototype.dispatch=function(){var a,b,c,e,f,g,h,i;g=arguments[0],e=2<=arguments.length?P.call(arguments,1):[],c=d(g,this),this._actedDuringAction=!1,this._currentAction=c,b=this.constructor._beforeFilters;if(b)for(h=0,i=b.length;h<i;h++)a=b[h],a.call(this);f=g.fire(e,this),!this._actedDuringAction&&f!==!1&&this.render(),delete this._actedDuringAction;return delete this._currentAction},a.prototype.redirect=function(a){this._actedDuringAction=!0;return g(a)},a.prototype.render=function(a){var b;a==null&&(a={}),this._actedDuringAction=!0,a.view||(a.source=v.underscore(this.constructor.name.replace("Controller",""))+"/"+this._currentAction+".html",a.view=new l.View(a));if(b=a.view){b.context||(b.context=this);return b.ready(function(){return l.DOM.contentFor("main",b.get("node"))})}};return a}(),l.Model=function(){function e(a){var b;a==null&&(a={}),this.save=S(this.save,this),this.dirtyKeys=new l.Hash,this.errors=new l.Set,e.__super__.constructor.apply(this,arguments),this.state()||this.empty(),b=i(a)==="Object"?a.id:a,b!=null&&this._id(b)}var a,b,c,d;R(e,l.Object),e.persist=function(){var a,b,c,d,e,f;b=1<=arguments.length?P.call(arguments,0):[],l.initializeObject(this.prototype),c=(d=this.prototype._batman).storage||(d.storage=[]);for(e=0,f=b.length;e<f;e++)a=b[e],c.push(a.isStorageAdapter?a:new a(this));return this},e.classAccessor("all",{get:function(){this.all||this.load();return this.all}}),e.classAccessor("first",{get:function(){return this.first=this.get("all")[0]}}),e.classAccessor("last",{get:function(){return this.last=this.get("all")[this.all.length-1]}}),e.find=function(a){var b,c,d,e;a=""+a,e=this.get("all").toArray();for(c=0,d=e.length;c<d;c++){b=e[c];if(b._id()===a)return b}b=new this(a),setTimeout(function(){return b.load()},0);return b},e.id="id",e.prototype._id=function(a){var b,c,d,e,f,g;d=this.constructor,c=(typeof d.id=="function"?d.id():void 0)||d.id||"id",arguments.length>0&&(a=""+a,l.initializeObject(d),f=(g=d._batman).records||(g.records={}),e=f[a],b=d.get("all"),e&&b.remove(e),f[a]=this,b.add(this));return this[c]},e.beforeLoad=e.event(function(){return this.get("all").clear()}),e.afterLoad=e.event(function(){}),e.load=function(a){var b,c,d,e,f,g,h,i,j;this.all||(this.all=new l.Set),this.beforeLoad(),b=S(function(){a!=null&&a.call(this);return this.afterLoad()},this),c=this.prototype._batman.getAll("storage"),d=!c.length;for(g=0,i=c.length;g<i;g++){f=c[g],d=d||!f.length;for(h=0,j=f.length;h<j;h++)e=f[h],e.readAllFromStorage(this,b)}if(d)return b()},e.encode=function(){var a,b,c,d,e,f,g,h,j,k,m;e=2<=arguments.length?P.call(arguments,0,h=arguments.length-1):(h=0,[]),c=arguments[h++],l.initializeObject(this.prototype),(f=this.prototype._batman).encoders||(f.encoders=new l.SimpleHash),(g=this.prototype._batman).decoders||(g.decoders=new l.SimpleHash);switch(i(c)){case"String":e.push(c);break;case"Function":b=c;break;default:b=c.encode,a=c.decode}m=[];for(j=0,k=e.length;j<k;j++)d=e[j],this.prototype._batman.encoders.set(d,b||this.defaultEncoder),m.push(this.prototype._batman.decoders.set(d,a||this.defaultDecoder));return m},e.defaultEncoder=e.defaultDecoder=function(a){return a},e.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,m;a=2<=arguments.length?P.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],l.initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,m=[];for(j=0,k=o.length;j<k;j++)f=o[j],m.push(function(){var e,h;if(c=f.matches(d)){for(e=0,h=c.length;e<h;e++)b=c[e],delete d[b];return g.push({keys:a,validator:new f(c)})}}());return m},e.mixin(l.StateMachine),d=["empty","dirty","loading","loaded","saving"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype.state(a);e.prototype.state("saved",function(){return this.dirtyKeys.clear()}),e.prototype.set=function(a,b){var c;c=this[a];if(c!==b){e.__super__.set.apply(this,arguments),this.dirtyKeys.set(a,c);if(this.state()!=="dirty")return this.dirty()}},e.accessor("dirtyKeys",{get:function(){return this.dirtyKeys}}),e.prototype.toString=function(){return""+this.constructor.name+": "+this._id()},e.prototype.toJSON=function(){var a,b;b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.each(S(function(a,c){var d,e;e=this.get(a);if(!j(e)){d=c(this.get(a));if(!j(d))return b[a]=d}},this));return b},e.prototype.fromJSON=function(a){var b,c,d,e;d={},b=this._batman.get("decoders");if(!b||b.isEmpty())for(c in a)e=a[c],d[v.camelize(c,!0)]=e;else b.each(function(b,c){return d[b]=c(a[b])});return this.mixin(d)},e.prototype.beforeLoad=e.event(function(){this.loading();return!0}),e.prototype.afterLoad=e.event(function(){this.loaded();return!0}),e.prototype.beforeCreate=e.event(function(){}),e.prototype.afterCreate=e.event(function(){}),e.prototype.beforeSave=e.event(function(){this.saving();return!0}),e.prototype.afterSave=e.event(function(){this.saved();return!0}),e.prototype.beforeValidation=e.event(function(){}),e.prototype.afterValidation=e.event(function(){}),e.prototype.load=function(a){var b,c,d,e,f,g,h,i,j;this.beforeLoad(),b=S(function(){a!=null&&a.call(this);return this.afterLoad()},this),c=this._batman.getAll("storage"),d=!c.length;for(g=0,i=c.length;g<i;g++){f=c[g],d=d||!f.length;for(h=0,j=f.length;h<j;h++)e=f[h],e.readFromStorage(this,b)}if(d)return b()},e.prototype.save=function(a){var b,c,d,e,f,g,h,i,j,k;if(!!this.isValid()){this.beforeSave(),d=this.isNew(),d&&this.beforeCreate(),b=S(function(){this.dirtyKeys.clear(),a!=null&&a.call!=null&&a!=null&&a.call(this),d&&this.afterCreate();return this.afterSave()},this),c=this._batman.getAll("storage"),e=!c.length;for(h=0,j=c.length;h<j;h++){g=c[h],e=e||!g.length;for(i=0,k=g.length;i<k;i++)f=g[i],f.writeToStorage(this,b)}if(e)return b()}},e.prototype.validate=function(){var a,b,c,d,e,f,g,h,i,j,k;this.beforeValidation(),a=!1,j=this._batman.get("validators")||[];for(f=0,h=j.length;f<h;f++){e=j[f],d=e.validator,k=e.keys;for(g=0,i=k.length;g<i;g++)b=k[g],c=new l.ValidatorPromise(this),d?d.validateEach(c,this,b,this.get(b)):e.callback(c,this,b,this.get(b)),c.paused?(this.prevent("afterValidation"),c.resume(S(function(){this.allow("afterValidation");return this.afterValidation()},this)),a=!0):c.canSucceed&&c.success()}return a?!1:this.afterValidation()},e.prototype.isNew=function(){return!this._id()},e.prototype.isValid=function(){this.errors.clear();if(this.validate()===!1)return!1;return this.errors.isEmpty()};return e}(),l.ValidatorPromise=function(){function a(a){this.record=a,this.canSucceed=!0}R(a,l.Object),a.prototype.error=function(a){this.record.errors.add(a);return this.canSucceed=!1},a.prototype.wait=function(){this.paused=!0;return this.canSucceed=!1},a.prototype.resume=a.event(function(){this.paused=!1;return!0}),a.prototype.success=function(){return this.canSucceed=!1};return a}(),l.Validator=function(){function a(){var b,c;c=arguments[0],b=2<=arguments.length?P.call(arguments,1):[],this.options=c,a.__super__.constructor.apply(this,b)}R(a,l.Object),a.prototype.validate=function(a){throw"You must override validate in Batman.Validator subclasses."},a.kind=function(){return v.underscore(this.name).replace("_validator","")},a.prototype.kind=function(){return this.constructor.kind()},a.options=function(){var a;a=1<=arguments.length?P.call(arguments,0):[],l.initializeObject(this);return this._batman.options?this._batman.options.concat(a):this._batman.options=a},a.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c};return a}(),o=l.Validators=[l.LengthValidator=function(){function a(b){var c;if(c=b.lengthIn||b.lengthWithin)b.minLength=c[0],b.maxLength=c[1]||-1,delete b.lengthWithin,delete b.lengthIn;a.__super__.constructor.apply(this,arguments)}R(a,l.Validator),a.options("minLength","maxLength","length","lengthWithin","lengthIn"),a.prototype.validateEach=function(a,b,c,d){var e;e=this.options,e.minLength&&d.length<e.minLength&&a.error(""+c+" must be at least "+e.minLength+" characters"),e.maxLength&&d.length>e.maxLength&&a.error(""+c+" must be less than "+e.maxLength+" characters");if(e.length&&d.length!==e.length)return a.error(""+c+" must be "+e.length+" characters")};return a}(),l.PresenceValidator=function(){function a(){a.__super__.constructor.apply(this,arguments)}R(a,l.Validator),a.options("presence"),a.prototype.validateEach=function(a,b,c,d){var e;e=this.options;if(e.presence&&d==null)return a.error(""+c+" must be present")};return a}()],l.StorageMechanism=function(){function a(a){this.model=a,this.modelKey=v.pluralize(v.underscore(this.model.name))}a.prototype.isStorageAdapter=!0;return a}(),l.LocalStorage=function(){function a(){var b;if(b=!1,T.call(window,b)>=0)return null;this.id=0,a.__super__.constructor.apply(this,arguments)}R(a,l.StorageMechanism),a.prototype.writeToStorage=function(a,b){var c,d;d=this.modelKey,c=a._id()||a._id(++this.id),d&&c&&(localStorage[d+c]=JSON.stringify(a));return b()},a.prototype.readFromStorage=function(a,b){var c,d,e;e=this.modelKey,c=a._id(),e&&c&&(d=localStorage[e+c]),a.fromJSON(JSON.parse(d));return b()},a.prototype.readAllFromStorage=function(a,b){var c,d,e,f,g;e=new RegExp("$"+this.modelKey);for(d in localStorage)g=localStorage[d],e.test(d)&&(c=JSON.parse(g),f=new a(-1),f.fromJSON(c));b()};return a}(),l.RestStorage=function(){function a(){a.__super__.constructor.apply(this,arguments)}R(a,l.StorageMechanism),a.prototype.optionsForRecord=function(a){var b,c;b={type:"json"},b.url=(a!=null?typeof a.url=="function"?a.url():void 0:void 0)||(a!=null?a.url:void 0)||(typeof (c=this.model).url=="function"?c.url():void 0)||this.model.url||this.modelKey,a&&!a.url&&(b.url+="/"+a._id());return b},a.prototype.writeToStorage=function(a,b){var c;c=f(this.optionsForRecord(a),{method:a._id()?"put":"post",data:JSON.stringify(a),success:function(){return b()},error:function(a){return b(a)}});return new l.Request(c)},a.prototype.readFromStorage=function(a,b){var c;c=f(this.optionsForRecord(a),{success:function(c){var d;typeof c=="string"&&(c=JSON.parse(c));for(d in c){c=c[d];break}a.fromJSON(c);return b()}});return new l.Request(c)},a.prototype.readAllFromStorage=function(a,b){var c;c=f(this.optionsForRecord(),{success:function(c){var d,e,f,g,h;typeof c=="string"&&(c=JSON.parse(c));if(!Array.isArray(c))for(d in c){c=c[d];break}for(g=0,h=c.length;g<h;g++)e=c[g],f=new a(""+e[a.id]),f.fromJSON(e);b()}});return new l.Request(c)};return a}(),l.View=function(){function b(){b.__super__.constructor.apply(this,arguments)}var a;R(b,l.Object),a={},b.prototype.source="",b.prototype.html="",b.prototype.node=null,b.prototype.context=null,b.prototype.contexts=null,b.prototype.contentFor=null,b.prototype.ready=b.eventOneShot(function(){}),b.prototype.prefix="views",b.observeAll("source",function(){return setTimeout(S(function(){return this.reloadSource()},this),0)}),b.prototype.reloadSource=function(){var b;b=this.get("source");if(!!b)return a[b]?this.set("html",a[b]):new l.Request({url:"views/"+this.source,type:"html",success:S(function(c){a[b]=c;return this.set("html",c)},this),error:function(a){throw"Could not load view from "+url}})},b.observeAll("html",function(a){var b;b=this.node||document.createElement("div"),b.innerHTML=a;if(this.node!==b)return this.set("node",b)}),b.observeAll("node",function(a){if(!!a){this.ready.fired=!1,this._renderer&&this._renderer.forgetAll();if(a){this._renderer=new l.Renderer(a,S(function(){var b,c;b=this.contentFor,typeof b=="string"&&(this.contentFor=(c=l.DOM._yields)!=null?c[b]:void 0),this.contentFor&&a&&(this.contentFor.innerHTML="",this.contentFor.appendChild(a));return this.ready(a)},this),this.contexts),this.context&&this._renderer.context.push(this.context);return this._renderer.context.set("view",this)}}});return b}(),l.Renderer=function(){function b(a,c,d){this.node=a,this.callback=c,d==null&&(d=[]),this.resume=S(this.resume,this),this.start=S(this.start,this),b.__super__.constructor.apply(this,arguments),this.context=d instanceof n?d:function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(n,d,function(){}),setTimeout(this.start,0)}var a;R(b,l.Object),b.prototype.start=function(){this.startTime=new Date;return this.parseNode(this.node)},b.prototype.resume=function(){this.startTime=new Date;return this.parseNode(this.resumeNode)},b.prototype.finish=function(){this.startTime=null;return typeof this.callback=="function"?this.callback():void 0},b.prototype.forgetAll=function(){},a=/data\-(.*)/,b.prototype.parseNode=function(b){var c,d,e,f,g,h,i,j,k,m,n,o,p;if(new Date-this.startTime>50)this.resumeNode=b,setTimeout(this.resume,0);else{if(b.getAttribute){this.context.set("node",b),o=b.attributes;for(k=0,m=o.length;k<m;k++){c=o[k],e=(p=c.nodeName.match(a))!=null?p[1]:void 0;if(!e)continue;g=(d=e.indexOf("-"))===-1?typeof (i=l.DOM.readers)[e]=="function"?i[e](b,c.value,this.context,this):void 0:typeof (j=l.DOM.attrReaders)[n=e.substr(0,d)]=="function"?j[n](b,e.substr(d+1),c.value,this.context,this):void 0;if(g===!1){h=!0;break}}}return(f=this.nextNode(b,h))?this.parseNode(f):this.finish()}},b.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}typeof a.onParseExit=="function"&&a.onParseExit(),f=a.nextSibling;if(f)return f;d=a;while(d=d.parentNode){typeof d.onParseExit=="function"&&d.onParseExit();if(d===this.node)return;e=d.nextSibling;if(e)return e}};return b}(),m=function(){function c(){var a;c.__super__.constructor.apply(this,arguments),this.parseFilter(),a=!0,l.DOM.nodeIsEditable(this.node)&&l.DOM.events.change(this.node,S(function(){a=!1,this.nodeChange?this.nodeChange(this.node,this._keyContext||this.value,this):this.key&&this.get("keyContext").set(this.key,this.node.value);return a=!0},this)),this.observe("filteredValue",!0,S(function(b){if(a)return this.dataChange?this.dataChange(b,this.node,this):l.DOM.valueForNode(this.node,b)},this)),this}var a,b;R(c,l.Object),b=/(?:^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w\.]*)\s*(?:$|,)/,a=/(\w)\[(.+?)\]/,c.accessor("filteredValue",{get:function(){var a;a=this.get("unfilteredValue");return this.filterFunctions.length>0?this.filterFunctions.reduce(S(function(a,b,c){var d;d=this.filterArguments[c].map(function(a){return a._keypath?a.context.get(a._keypath):a});return b.apply(null,[a].concat(P.call(d)))},this),a):a}}),c.accessor("unfilteredValue",{get:function(){return this.get("key")?this.get("keyContext."+this.get("key")):this.get("value")}}),c.accessor("keyContext",{get:function(){var a,b;this._keyContext||(b=this.renderContext.findKey(this.key),a=b[0],this._keyContext=b[1]);return this._keyContext}}),c.prototype.parseFilter=function(){var b,c,d,e,f,g,h,i;this.filterFunctions=[],this.filterArguments=[],f=this.keyPath.replace(a,"$1 | get $2 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{g=this.parseSegment(h=f.shift())[0]}catch(j){throw'Bad binding keypath "'+h+'"!'}g._keypath?this.key=g._keypath:this.value=g;if(f.length){while(e=f.shift()){i=e.indexOf(" "),~i?(d=e.substr(0,i),b=e.substr(i)):d=e;if(!(c=l.Filters[d]))throw new Error("Unrecognized filter "+c+' in key "'+this.keyPath+'"!');this.filterFunctions.push(c);if(b)try{this.filterArguments.push(this.parseSegment(b))}catch(j){throw new Error('Bad filter arguments "'+b+'"!')}else this.filterArguments.push([])}return this.filterArguments=this.filterArguments.map(S(function(a){return a.map(S(function(a){var b,c;a._keypath&&(c=this.renderContext.findKey(a._keypath),b=c[0],a.context=c[1]);return a},this))},this))}},c.prototype.parseSegment=function(a){return JSON.parse("["+a.replace(b,'{"_keypath": "$1"}')+"]")};return c}(),n=function(){function b(){var a;a=1<=arguments.length?P.call(arguments,0):[],this.contexts=a,this.storage=new l.Object,this.contexts.push(this.storage)}var a;b.prototype.findKey=function(a){var b,c,d,f;b=a.split(".")[0].split("|")[0].trim(),d=this.contexts.length;while(d--){c=this.contexts[d],c.get!=null?f=c.get(b):f=c[b];if(!j(f))return[e(c,a),c]}return[s.get(a),s]},b.prototype.set=function(){var a,b;a=1<=arguments.length?P.call(arguments,0):[];return(b=this.storage).set.apply(b,a)},b.prototype.push=function(a){return this.contexts.push(a)},b.prototype.pop=function(){return this.contexts.pop()},b.prototype.clone=function(){var a;a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(this.constructor,this.contexts,function(){}),a.setStorage(this.storage);return a},b.prototype.setStorage=function(a){this.contexts.splice(this.contexts.indexOf(this.storage),1),this.push(a);return a},a=function(){function a(a,b){this.binding=a,this.localKey=b,this.localKey?this.accessor(this.localKey,{get:function(){return this.binding.get("filteredValue")}}):this.accessor({get:function(a){return this.binding.get("filteredValue."+a)}})}R(a,l.Object),a.prototype.isBindingProxy=!0;return a}(),b.prototype.addKeyToScopeForNode=function(b,c,d){this.bind(b,c,S(function(b,c,e){return this.push(new a(e,d))},this),function(){return!0});return b.onParseExit=S(function(){return this.pop()},this)},b.prototype.bind=function(a,b,c,d){return new m({renderContext:this,keyPath:b,node:a,dataChange:c,nodeChange:d})};return b}(),l.DOM={readers:{bind:function(a,b,c){return a.nodeName.toLowerCase()==="input"&&a.getAttribute("type")==="checkbox"?l.DOM.attrReaders.bind(a,"checked",b,c):c.bind(a,b)},context:function(a,b,c){return c.addKeyToScopeForNode(a,b)},mixin:function(a,b,c){c.push(l.mixins),c.bind(a,b,function(b){return f(a,b)},function(){});return c.pop()},showif:function(a,b,c,d,e){var f;f=a.style.display;if(!f||f==="none")f="block";return c.bind(a,b,function(b){return!!b==!e?typeof a.show=="function"?a.show():a.style.display=f:typeof a.hide=="function"?a.hide():a.style.display="none"},function(){})},hideif:function(){var a,b;a=1<=arguments.length?P.call(arguments,0):[];return(b=l.DOM.readers).showif.apply(b,P.call(a).concat([!0]))},route:function(a,b,c){var d,e,f,g,h,i,j;b.substr(0,1)==="/"?(h=l.redirect.bind(l,b),i=b):(g=b.indexOf("#"))!==-1?(e=v.camelize(b.substr(0,g))+"Controller",d=c.get(e),h=d!=null?d.sharedInstance()[b.substr(g+1)]:void 0,i=h!=null?h.pattern:void 0):(h=c.get(b),h instanceof l.Model?(e=v.camelize(v.pluralize(b))+"Controller",d=c.get(e).sharedInstance(),f=h._id(),h=(j=d.show)!=null?j.bind(d,{id:f}):void 0,i="/"+v.pluralize(b)+"/"+f):i=h.pattern),a.nodeName.toUpperCase()==="A"&&(a.href=l.HASH_PATTERN+(i||""));return l.DOM.events.click(a,function(){return typeof h=="function"?h():void 0})},partial:function(a,b,c){var d;return d=new l.View({source:b+".html",contentFor:a,contexts:Array.prototype.slice.call(c.contexts)})},yield:function(a,b){return setTimeout(function(){return l.DOM.yield(b,a)},0)},contentfor:function(a,b){return setTimeout(function(){return l.DOM.contentFor(b,a)},0)}},attrReaders:{_parseAttribute:function(a){a==="false"&&(a=!1),a==="true"&&(a=!0);return a},bind:function(a,b,c,d){var e,f;switch(b){case"checked":e=function(b){return a.checked=!!b},f=function(a,b){return b.set(c,l.DOM.attrReaders._parseAttribute(a.checked))};break;case"value":e=function(b){return a.value=b},f=function(a,b){return b.set(c,l.DOM.attrReaders._parseAttribute(a.value))};break;default:e=function(c){return a.setAttribute(b,c)},f=function(a,d){return d.set(c,l.DOM.attrReaders._parseAttribute(a.getAttribute(b)))}}return d.bind(a,c,e,f)},context:function(a,b,c,d){return d.addKeyToScopeForNode(a,c,b)},event:function(a,b,c,d){var e,f,g;c.substr(0,1)==="@"?e=new Function(c.substr(1)):(g=d.findKey(c),e=g[0],f=g[1]);return l.DOM.events[b](a,function(){var b;b=a.getAttribute("data-confirm");if(!b||!!confirm(b))return e!=null?e.apply(f,arguments):void 0})},addclass:function(a,b,c,d,e,f){b=b.replace(/\|/g," ");return d.bind(a,c,function(c){var d,e;d=a.className,e=d.indexOf(b)!==-1;if(!!c==!f){if(!e)return a.className=""+d+" "+b}else if(e)return a.className=d.replace(b,"")},function(){})},removeclass:function(){var a,b;a=1<=arguments.length?P.call(arguments,0):[];return(b=l.DOM.attrReaders).addclass.apply(b,P.call(a).concat([!0]))},foreach:function(a,b,c,d,e){var f,g,h,i,j,k,m;i=a.cloneNode(!0),i.removeAttribute("data-foreach-"+b),h=a.parentNode,m=a.nextSibling,setTimeout(function(){if(a.nextSibling!=null)return h.removeChild(a)},0),g=new l.Hash,f=function(){var a,c,f,j,k,n,o,p;c=1<=arguments.length?P.call(arguments,0):[],p=[];for(n=0,o=c.length;n<o;n++)a=c[n],k=i.cloneNode(!0),g.set(a,k),j=d.clone(),f=new l.Object,f[b]=a,j.push(f),j.push(a),p.push(new l.Renderer(k,function(a){return function(){h.insertBefore(a,m);return e.allow("ready")}}(k),j));return p},j=function(){var a,b,c,d,e,f,h;b=1<=arguments.length?P.call(arguments,0):[],h=[];for(d=0,e=b.length;d<e;d++)a=b[d],c=g.get(a),g.unset(a),h.push(c!=null?(f=c.parentNode)!=null?f.removeChild(c):void 0:void 0);return h},k=function(a){var b,c,d,e,f;e=a.toArray(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(h.insertBefore(g.get(b),m));return f},d.bind(a,c,function(a){var b,c,d;if(a!=null?a.observe:void 0)a.observe("itemsWereAdded",f),a.observe("itemsWereRemoved",j),a.observe("setWasSorted",k);if(a.each)return a.each(function(a,b){return f(b!=null?b:a)});if(a.forEach)return a.forEach(function(a){return f(a)});d=[];for(b in a)c=a[b],d.push(f(c));return d},function(){});return!1},formfor:function(a,b,c,d){var e;e=d.addKeyToScopeForNode(a,c,b);return l.DOM.events.submit(a,function(a){return a.preventDefault()})}},events:{click:function(a,b){l.DOM.addEventListener(a,"click",function(c){b(a,c);return c.preventDefault()}),a.nodeName.toUpperCase()==="A"&&!a.href&&(a.href="#");return a},change:function(a,b){var c,d,e,f,g;d=function(){switch(a.nodeName.toUpperCase()){case"TEXTAREA":return["keyup","change"];case"INPUT":if(a.type.toUpperCase()==="TEXT"){e=b,b=function(a){var b;if(!(a.type==="keyup"&&13<=(b=a.keyCode)&&b<=14))return e.apply(null,arguments)};return["keyup","change"]}return["change"];default:return["change"]}}();for(f=0,g=d.length;f<g;f++)c=d[f],l.DOM.addEventListener(a,c,function(c){return b(a,c)});return a},submit:function(a,b){l.DOM.nodeIsEditable(a)?l.DOM.addEventListener(a,"keyup",function(c){if(c.keyCode===13){b(a,c);return c.preventDefault()}}):l.DOM.addEventListener(a,"submit",function(c){b(a,c);return c.preventDefault()});return a}},yield:function(a,b){var c,d,e,f;d=(e=l.DOM)._yields||(e._yields={}),d[a]=b;if(c=(f=l.DOM._yieldContents)!=null?f[a]:void 0){b.innerHTML="";if(c)return b.appendChild(c)}},contentFor:function(a,b){var c,d,e,f;c=(e=l.DOM)._yieldContents||(e._yieldContents={}),c[a]=b;if(d=(f=l.DOM._yields)!=null?f[a]:void 0){d.innerHTML="";if(b)return d.appendChild(b)}},valueForNode:function(a,b){var c;c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;default:return c?a.innerHTML=b:a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"},addEventListener:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}},q=/(?:^|_)(.)/g,r=/(^|\s)([a-z])/g,C=/([A-Z]+)([A-Z][a-z])/g,D=/([a-z\d])([A-Z])/g,v=l.helpers={camelize:function(a,b){a=a.replace(q,function(a,b){return b.toUpperCase()});return b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(C,"$1_$2").replace(D,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){return a.substr(-3)==="ies"?a.substr(0,a.length-3)+"y":a.substr(-1)==="s"?a.substr(0,a.length-1):a},pluralize:function(a,b){var c;if(b){if(a===1)return b}else b=a;c=b.substr(-1);return c==="y"?""+b.substr(0,b.length-1)+"ies":c==="s"?b:""+b+"s"},capitalize:function(a){return a.replace(r,function(a,b,c){return b+c.toUpperCase()})}},p=function(a){return function(b){if(!j(b))return a.apply(this,arguments)}},u=l.Filters={get:p(function(a,b){return a.get!=null?a.get(b):a[b]}),truncate:p(function(a,b,c){c==null&&(c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c);return a}),"default":function(a,b){return a||b},prepend:function(a,b){return b+a},append:function(a,b){return a+b},downcase:p(function(a){return a.toLowerCase()}),upcase:p(function(a){return a.toUpperCase()}),pluralize:p(function(a,b){return v.pluralize(b,a)}),join:p(function(a,b){b==null&&(b="");return a.join(b)}),sort:p(function(a){return a.sort()}),map:p(function(a,b){return a.map(function(a){return a[b]})}),first:p(function(a){return a[0]})},N=["capitalize","singularize","underscore","camelize"];for(I=0,K=N.length;I<K;I++)w=N[I],u[w]=p(v[w]);x=l.mixins=new l.Object,s=typeof exports!="undefined"&&exports!==null?(module.exports=l,global):(window.Batman=l,window),f(s,l.Observable),l.exportHelpers=function(a){var b,c,d,e;e=["mixin","unmixin","route","redirect","event","eventOneShot","typeOf"];for(c=0,d=e.length;c<d;c++)b=e[c],a["$"+b]=l[b];return a},l.exportGlobals=function(){return l.exportHelpers(s)},l.Request.prototype.send=function(a){return jQuery.ajax(this.get("url"),{type:this.get("method"),dataType:this.get("type"),data:a||this.get("data"),username:this.get("username"),password:this.get("password"),beforeSend:S(function(){return this.loading(!0)},this),success:S(function(a){this.set("response",a);return this.success(a)},this),error:S(function(a,b,c){this.set("response",c);return this.error(c)},this),complete:S(function(){this.loading(!1);return this.loaded(!0)},this)})}}).call(this)